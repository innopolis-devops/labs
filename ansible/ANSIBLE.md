# Local run

```sh
$ ansible-playbook playbooks/dev/main.yaml

[WARNING]: provided hosts list is empty, only localhost is available. Note that the implicit localhost does not match 'all'

PLAY [Prepare docker] **********************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] *********************************************************************************************************************************************************************************************************************
ok: [127.0.0.1]

TASK [docker : include_tasks] **************************************************************************************************************************************************************************************************************
included: /home/nihon/Inno/devops/ansible/roles/docker/tasks/setup_debian.yaml for 127.0.0.1

TASK [docker : Ensure old versions of Docker are not installed.] ***************************************************************************************************************************************************************************
ok: [127.0.0.1]

TASK [docker : Ensure dependencies are installed.] *****************************************************************************************************************************************************************************************
ok: [127.0.0.1]

TASK [docker : Ensure additional dependencies are installed (on Ubuntu < 20.04 and any other systems).] ************************************************************************************************************************************
skipping: [127.0.0.1]

TASK [docker : Ensure additional dependencies are installed (on Ubuntu >= 20.04).] *********************************************************************************************************************************************************
ok: [127.0.0.1]

TASK [docker : Add Docker apt key.] ********************************************************************************************************************************************************************************************************
ok: [127.0.0.1]

TASK [docker : Ensure curl is present (on older systems without SNI).] *********************************************************************************************************************************************************************
skipping: [127.0.0.1]

TASK [docker : Add Docker repository.] *****************************************************************************************************************************************************************************************************
ok: [127.0.0.1]

TASK [docker : include_tasks] **************************************************************************************************************************************************************************************************************
included: /home/nihon/Inno/devops/ansible/roles/docker/tasks/install_docker.yaml for 127.0.0.1

TASK [docker : Install Docker packages (with downgrade option).] ***************************************************************************************************************************************************************************
ok: [127.0.0.1]

TASK [docker : Ensure /etc/docker/ directory exists.] **************************************************************************************************************************************************************************************
skipping: [127.0.0.1]

TASK [docker : Configure Docker daemon options.] *******************************************************************************************************************************************************************************************
skipping: [127.0.0.1]

TASK [docker : Ensure Docker is started and enabled at boot.] ******************************************************************************************************************************************************************************
ok: [127.0.0.1]

TASK [docker : Ensure handlers are notified now to avoid firewall conflicts.] **************************************************************************************************************************************************************

TASK [docker : include_tasks] **************************************************************************************************************************************************************************************************************
included: /home/nihon/Inno/devops/ansible/roles/docker/tasks/install_compose.yaml for 127.0.0.1

TASK [docker : Check current docker-compose version.] **************************************************************************************************************************************************************************************
ok: [127.0.0.1]

TASK [docker : set_fact] *******************************************************************************************************************************************************************************************************************
ok: [127.0.0.1]

TASK [docker : Delete existing docker-compose version if it's different.] ******************************************************************************************************************************************************************
ok: [127.0.0.1]

TASK [docker : Ensure installation directory exists.] **************************************************************************************************************************************************************************************
skipping: [127.0.0.1]

TASK [docker : Install Docker Compose (if configured).] ************************************************************************************************************************************************************************************
changed: [127.0.0.1]

TASK [docker : Get docker group info using getent.] ****************************************************************************************************************************************************************************************
skipping: [127.0.0.1]

TASK [docker : Check if there are any users to add to the docker group.] *******************************************************************************************************************************************************************

TASK [docker : include_tasks] **************************************************************************************************************************************************************************************************************
skipping: [127.0.0.1]

PLAY RECAP *********************************************************************************************************************************************************************************************************************************
127.0.0.1                  : ok=15   changed=1    unreachable=0    failed=0    skipped=8    rescued=0    ignored=0
```

# Yandex Cloud

```sh
$ ansible-playbook playbooks/yandex/main.yaml 

PLAY [Prepare docker] **********************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] *********************************************************************************************************************************************************************************************************************
ok: [vm1]

TASK [docker : include_tasks] **************************************************************************************************************************************************************************************************************
included: /home/nihon/Inno/devops/ansible/roles/docker/tasks/setup_debian.yaml for vm1

TASK [docker : Ensure old versions of Docker are not installed.] ***************************************************************************************************************************************************************************
ok: [vm1]

TASK [docker : Ensure dependencies are installed.] *****************************************************************************************************************************************************************************************
changed: [vm1]

TASK [docker : Ensure additional dependencies are installed (on Ubuntu < 20.04 and any other systems).] ************************************************************************************************************************************
skipping: [vm1]

TASK [docker : Ensure additional dependencies are installed (on Ubuntu >= 20.04).] *********************************************************************************************************************************************************
ok: [vm1]

TASK [docker : Add Docker apt key.] ********************************************************************************************************************************************************************************************************
changed: [vm1]

TASK [docker : Ensure curl is present (on older systems without SNI).] *********************************************************************************************************************************************************************
skipping: [vm1]

TASK [docker : Add Docker repository.] *****************************************************************************************************************************************************************************************************
changed: [vm1]

TASK [docker : include_tasks] **************************************************************************************************************************************************************************************************************
included: /home/nihon/Inno/devops/ansible/roles/docker/tasks/install_docker.yaml for vm1

TASK [docker : Install Docker packages (with downgrade option).] ***************************************************************************************************************************************************************************
changed: [vm1]

TASK [docker : Ensure /etc/docker/ directory exists.] **************************************************************************************************************************************************************************************
skipping: [vm1]

TASK [docker : Configure Docker daemon options.] *******************************************************************************************************************************************************************************************
skipping: [vm1]

TASK [docker : Ensure Docker is started and enabled at boot.] ******************************************************************************************************************************************************************************
ok: [vm1]

TASK [docker : Ensure handlers are notified now to avoid firewall conflicts.] **************************************************************************************************************************************************************

RUNNING HANDLER [docker : restart docker] **************************************************************************************************************************************************************************************************
changed: [vm1]

TASK [docker : include_tasks] **************************************************************************************************************************************************************************************************************
included: /home/nihon/Inno/devops/ansible/roles/docker/tasks/install_compose.yaml for vm1

TASK [docker : Check current docker-compose version.] **************************************************************************************************************************************************************************************
ok: [vm1]

TASK [docker : set_fact] *******************************************************************************************************************************************************************************************************************
ok: [vm1]

TASK [docker : Delete existing docker-compose version if it's different.] ******************************************************************************************************************************************************************
ok: [vm1]

TASK [docker : Ensure installation directory exists.] **************************************************************************************************************************************************************************************
skipping: [vm1]

TASK [docker : Install Docker Compose (if configured).] ************************************************************************************************************************************************************************************
changed: [vm1]

TASK [docker : Get docker group info using getent.] ****************************************************************************************************************************************************************************************
skipping: [vm1]

TASK [docker : Check if there are any users to add to the docker group.] *******************************************************************************************************************************************************************

TASK [docker : include_tasks] **************************************************************************************************************************************************************************************************************
skipping: [vm1]

PLAY RECAP *********************************************************************************************************************************************************************************************************************************
vm1                        : ok=16   changed=6    unreachable=0    failed=0    skipped=8    rescued=0    ignored=0
```

## Inventory

```sh
$ ansible-inventory -i inventory/yacloud_compute.yaml --list

{
    "_meta": {
        "hostvars": {
            "vm1": {
                "ansible_host": "51.250.104.20"
            }
        }
    },
    "all": {
        "children": [
            "ungrouped",
            "yacloud"
        ]
    },
    "yacloud": {
        "hosts": [
            "vm1"
        ]
    }
}
```

Dynamic inventory is used: we do not need to provide hardcoded hosts (checkout `./inventory/yacloud_compute.yaml`)


# Lab 6

```sh
$ ansible-playbook playbooks/yandex/main.yaml 

PLAY [Deploy] ******************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] *********************************************************************************************************************************************************************************************************************
ok: [terraform1]
ok: [terraform2]

TASK [docker : include_tasks] **************************************************************************************************************************************************************************************************************
included: /home/nihon/Inno/devops/ansible/roles/docker/tasks/setup_debian.yaml for terraform1, terraform2

TASK [docker : Ensure old versions of Docker are not installed.] ***************************************************************************************************************************************************************************
ok: [terraform2]
ok: [terraform1]

TASK [docker : Ensure dependencies are installed.] *****************************************************************************************************************************************************************************************
ok: [terraform2]
ok: [terraform1]

TASK [docker : Ensure additional dependencies are installed (on Ubuntu < 20.04 and any other systems).] ************************************************************************************************************************************
skipping: [terraform1]
skipping: [terraform2]

TASK [docker : Ensure additional dependencies are installed (on Ubuntu >= 20.04).] *********************************************************************************************************************************************************
ok: [terraform2]
ok: [terraform1]

TASK [docker : Add Docker apt key.] ********************************************************************************************************************************************************************************************************
ok: [terraform1]
ok: [terraform2]

TASK [docker : Ensure curl is present (on older systems without SNI).] *********************************************************************************************************************************************************************
skipping: [terraform1]
skipping: [terraform2]

TASK [docker : Add Docker repository.] *****************************************************************************************************************************************************************************************************
ok: [terraform1]
ok: [terraform2]

TASK [docker : include_tasks] **************************************************************************************************************************************************************************************************************
included: /home/nihon/Inno/devops/ansible/roles/docker/tasks/install_docker.yaml for terraform1, terraform2

TASK [docker : Install Docker packages (with downgrade option).] ***************************************************************************************************************************************************************************
ok: [terraform2]
ok: [terraform1]

TASK [docker : Install pip] ****************************************************************************************************************************************************************************************************************
ok: [terraform2]
ok: [terraform1]

TASK [docker : Install docker module] ******************************************************************************************************************************************************************************************************
ok: [terraform2]
ok: [terraform1]

TASK [docker : Install compose module] *****************************************************************************************************************************************************************************************************
ok: [terraform2]
ok: [terraform1]

TASK [docker : Ensure /etc/docker/ directory exists.] **************************************************************************************************************************************************************************************
skipping: [terraform1]
skipping: [terraform2]

TASK [docker : Configure Docker daemon options.] *******************************************************************************************************************************************************************************************
skipping: [terraform1]
skipping: [terraform2]

TASK [docker : Ensure Docker is started and enabled at boot.] ******************************************************************************************************************************************************************************
ok: [terraform1]
ok: [terraform2]

TASK [docker : Ensure handlers are notified now to avoid firewall conflicts.] **************************************************************************************************************************************************************

TASK [docker : include_tasks] **************************************************************************************************************************************************************************************************************
included: /home/nihon/Inno/devops/ansible/roles/docker/tasks/install_compose.yaml for terraform1, terraform2

TASK [docker : Check current docker-compose version.] **************************************************************************************************************************************************************************************
ok: [terraform2]
ok: [terraform1]

TASK [docker : set_fact] *******************************************************************************************************************************************************************************************************************
ok: [terraform1]
ok: [terraform2]

TASK [docker : Delete existing docker-compose version if it's different.] ******************************************************************************************************************************************************************
skipping: [terraform1]
skipping: [terraform2]

TASK [docker : Ensure installation directory exists.] **************************************************************************************************************************************************************************************
skipping: [terraform1]
skipping: [terraform2]

TASK [docker : Install Docker Compose (if configured).] ************************************************************************************************************************************************************************************
skipping: [terraform1]
skipping: [terraform2]

TASK [docker : Get docker group info using getent.] ****************************************************************************************************************************************************************************************
skipping: [terraform1]
skipping: [terraform2]

TASK [docker : Check if there are any users to add to the docker group.] *******************************************************************************************************************************************************************

TASK [docker : include_tasks] **************************************************************************************************************************************************************************************************************
skipping: [terraform1]
skipping: [terraform2]

TASK [app : Stop all services] *************************************************************************************************************************************************************************************************************
skipping: [terraform1]
skipping: [terraform2]

TASK [app : Remove app directory] **********************************************************************************************************************************************************************************************************
skipping: [terraform1]
skipping: [terraform2]

TASK [app : Create a directory if it doesn't exist] ****************************************************************************************************************************************************************************************
ok: [terraform1]
ok: [terraform2]

TASK [app : Template, validate, and copy compose file] *************************************************************************************************************************************************************************************
ok: [terraform1]
ok: [terraform2]

TASK [app : Start all services] ************************************************************************************************************************************************************************************************************
changed: [terraform2]
changed: [terraform1]

PLAY RECAP *********************************************************************************************************************************************************************************************************************************
terraform1                 : ok=19   changed=1    unreachable=0    failed=0    skipped=12   rescued=0    ignored=0   
terraform2                 : ok=19   changed=1    unreachable=0    failed=0    skipped=12   rescued=0    ignored=0
```