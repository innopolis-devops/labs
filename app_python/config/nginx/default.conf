proxy_cache_path /var/cache/nginx/admin levels=1:2 keys_zone=admin_cache:20m max_size=2g inactive=160m use_temp_path=off;

upstream backend {
    server unix:///tmp/app/app.sock;
}

server {
    listen                  80;
    server_name             default_server;
    charset                 utf-8;
    client_max_body_size    5M;

    proxy_set_header        Host                    $host;
    proxy_set_header        X-Real-IP               $http_x_forwarded_for;
    proxy_set_header        X-Forwarded-For         $http_x_forwarded_for;


    location ~ ^/(docs|openapi.json) {
        auth_basic              "Docs";
        auth_basic_user_file    /etc/nginx/.htpasswd;

        proxy_pass              http://backend$uri;

        proxy_hide_header       Cache-Control;
        proxy_cache             admin_cache;
        proxy_cache_key         $uri;
        proxy_cache_lock        on;
        proxy_cache_valid       5s;
        proxy_cache_min_uses    5;
        proxy_cache_use_stale   error timeout invalid_header http_500 http_503;
        proxy_cache_revalidate  on;
        proxy_cache_background_update   on;
    }

    location / {
        proxy_pass              http://backend;
    }
}
