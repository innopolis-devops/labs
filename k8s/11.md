## create secrets
### use kubectl
1) create a secret using `kubectl create secret generic moscow-secret --from-literal=username=geralizz --from-literal=password='kogdaetokonchica'` command

2) `kubectl describe secret moscow-secret`
```
        Name:         moscow-secret
        Namespace:    default
        Labels:       <none
        Annotations:  <none>
        Type:  Opaque

        Data
        ====
        password:  16 bytes
        username:  8 bytes
```

3) decoding secret with `kubectl get secret moscow-secret -o jsonpath='{.data}'` and `echo "a29nZGFldG9rb25jaGljYQ==" | base64 --decode`. the result is `kogdaetokonchica`

### use helm

1) add `env` section to `deployment.yaml` 
```
env:
            - name: MOSCOW_USER
              valueFrom:
                secretKeyRef:
                  name: moscow-secret
                  key: user
            - name: MOSCOW_PASS
              valueFrom:
                secretKeyRef:
                  name: moscow-secret
                  key: password
```

2) watch [video](https://www.youtube.com/watch?v=hRSlKRvYe1A) (wow this man has the bluest eyes i've ever seen)

3) install plugin `helm plugin install https://github.com/jkroepke/helm-secrets`

4) install gpg using `sudo apt install gnupg`

5) create a key

6) receive fingerprint

7) use sops -p <fingerprint> secrets.yaml to create a secret (and create a secret)

8) QUIT THE VIM by tapping `esc`, `:wq` and `enter`

9) decrypt secret using `helm secrets decrypt secrets.yaml` command

10) oopsie looks like I have an error 

```
gpg: public key decryption failed: Inappropriate ioctl for device
gpg: decryption failed: No secret key
PANIC: could not retrieve a key to encrypt/decrypt the tree
[helm-secrets] Error while decrypting file: secrets.yaml
[helm-secrets] File is not encrypted: secrets.yaml
Error: plugin "secrets" exited with error
```

11) googling the problem

12) THERE'S A FIX `export GPG_TTY=$(tty)`

13) decrypt the secret FINALLY

`password: dontdropmeplease`

14) hmmmmmmm lools like sops version is out of date HOW UNEXPECTED

15) uninstall sops `pip uninstall sops`

16) download ACTUAL sops version with `wget https://github.com/mozilla/sops/releases/download/v3.7.3/sops_3.7.3_amd64.deb` and `sudo apt install ./sops_3.7.3_amd64.deb`

17) delete old `secrets.yaml` file and create new

18) run `helm secrets install mostime ./mostime/ -f ./secrets.yaml`

FINALLY!!!!!!!!!!!

```
[helm-secrets] Decrypt: ./secrets.yaml
NAME: mostime
LAST DEPLOYED: Mon Feb 13 01:00:15 2023
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
1. Get the application URL by running these commands:
     NOTE: It may take a few minutes for the LoadBalancer IP to be available.
           You can watch the status of by running 'kubectl get --namespace default svc -w mostime'
  export SERVICE_IP=$(kubectl get svc --namespace default mostime --template "{{ range (index .status.loadBalancer.ingress 0) }}{{.}}{{ end }}")
  echo http://$SERVICE_IP:8080

[helm-secrets] Removed: ./secrets.yaml.dec
```
