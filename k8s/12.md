# 12 - K8s ConfigMaps

## Changes in deployment configs

We modify the *helm/templates/deployment.yaml* to add lines

```commandline
volumeMounts:
- name: config-volume
    mountPath: /config.json
    subPath: config.json
```

and

```commandline
volumes:
- name: config-volume
    configMap:
    name: {{ include "helm.fullname" . }}-configmap
```

We also add *helm/templates/configmap.yaml* with

```commandline
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "helm.fullname" . }}-configmap
data:
  config.json: |-
    {{ .Files.Get "files/config.json" | nindent 4 }}
```

We then add *helm/files/config,json* with

```json
{
    "Author": "Roman Nabiullin",
    "Experience": "Ultra super senior devops engineer",
    "Device": "Macbook Pro 2019"  
}
```

## Running

Build again

```commandline
whutao@Romans-MacBook-Pro k8s % helm secrets install helm ./helm -f secrets.yaml
NAME: helm
LAST DEPLOYED: Thu Dec  8 16:07:46 2022
NAMESPACE: default
STATUS: deployed
REVISION: 1
NOTES:
1. Get the application URL by running these commands:
     NOTE: It may take a few minutes for the LoadBalancer IP to be available.
           You can watch the status of by running 'kubectl get --namespace default svc -w helm'
  export SERVICE_IP=$(kubectl get svc --namespace default helm --template "{{ range (index .status.loadBalancer.ingress 0) }}{{.}}{{ end }}")
  echo http://$SERVICE_IP:80
secrets.yaml.dec
```

Check pods

```commandline
whutao@Romans-MacBook-Pro k8s % kubectl get pods,svc                                                 
NAME                        READY   STATUS    RESTARTS   AGE
pod/helm-85995d9bff-v9n6n   1/1     Running   0          117s

NAME                      TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE
service/helm              LoadBalancer   10.100.21.79    <pending>     80:30962/TCP   117s
service/kubernetes        ClusterIP      10.96.0.1       <none>        443/TCP        42h
```

Then access the config file

```commandline
whutao@Romans-MacBook-Pro k8s % kubectl exec pod/helm-85995d9bff-v9n6n -- cat ../config.json
{
    "Author": "Roman Nabiullin",
    "Experience": "Ultra super senior devops engineer",
    "Device": "Macbook Pro 2019"  
}     
```
