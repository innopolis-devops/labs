# 13 - K8s StatefulSet

We modify *helm/values.yaml* to add condigs for the volumes and rename *helm/templates/deployment.yaml* to *helm/templates/statefulset.yaml* with minor changes.

After setting `replicaCount: 2`, we will see two instances instead of one.

```commandline
whutao@Romans-MacBook-Pro k8s % kubectl get pods,svc,pvc,sts
NAME         READY   STATUS    RESTARTS   AGE
pod/helm-0   1/1     Running   0          2m51s
pod/helm-1   1/1     Running   0          2m51s

NAME                      TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE
service/helm              LoadBalancer   10.107.34.21    <pending>     80:32482/TCP   2m51s
service/kubernetes        ClusterIP      10.96.0.1       <none>        443/TCP        44h

NAME                                             STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
persistentvolumeclaim/persistent-volume-helm-0   Bound    pvc-f1873924-8804-4356-90ff-7366b078f4d4   64Mi       RWO            standard       2m51s
persistentvolumeclaim/persistent-volume-helm-1   Bound    pvc-eba9e384-4df1-4ad1-83c3-d4b55dca6943   64Mi       RWO            standard       2m51s

NAME                    READY   AGE
statefulset.apps/helm   2/2     2m51s
```

After checking `visits.json` in each instance, we see different number of visits to the main pages.

```commandline
whutao@Romans-MacBook-Pro k8s % kubectl exec pod/helm-0 -- cat ../app/data/visits.json
156
```

```commandline
whutao@Romans-MacBook-Pro k8s % kubectl exec pod/helm-1 -- cat ../app/data/visits.json
164
```

This happens because each instance has its own separate volume. LoadBalancer decides to which pod forward the requests and distributes the load almost equaly. Also, by setting `podManagementPolicy: "Parallel"`, we can make instances to work in parallel.
