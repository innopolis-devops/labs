# Lab 14

## Kube Prometheus Stack components

- The Prometheus Operator: used to simplify and automate the configuration of a Prometheus for Kubernetes, provides Kubernetes native deployment, management of Prometheus and related monitoring components.

- Highly available Prometheus: used for monitoring and alerting cloud environments.

- Highly available Alertmanager: used for handling alerts from client applications as Prometheus.

- Prometheus node-exporter: used for exporting Prometheus for hardware and OS metrics.

- Prometheus Adapter for Kubernetes Metrics APIs: an implementation of the Kubernetes resource metrics, custom metrics, and external metrics APIs.

- kube-state-metrics: generates metrics listening to Kubernetes API.

- Grafana: used to analyze and vizualize metrics from web applications.

## ```kubectl get po,sts,svc,pvc,cm```

po - Pod
sts - StatefulSet
svc - Service
pvc - PersistentVolumeClaim
cm - ConfigMap

```bash
NAME                                                         READY   STATUS    RESTARTS       AGE
pod/alertmanager-main-kube-prometheus-stack-alertmanager-0   2/2     Running   1 (13m ago)    13m
pod/app-python-0                                             1/1     Running   0              10m
pod/app-python-1                                             1/1     Running   0              10m
pod/main-grafana-7859fdf988-vxj8r                            3/3     Running   0              13m
pod/main-kube-prometheus-stack-operator-6c477f97c4-sf8wl     1/1     Running   0              13m
pod/main-kube-state-metrics-6447948f45-9kxhw                 1/1     Running   0              13m
pod/main-prometheus-node-exporter-p2q82                      1/1     Running   0              13m
pod/prometheus-main-kube-prometheus-stack-prometheus-0       2/2     Running   0              13m

NAME                                                                    READY   AGE
statefulset.apps/alertmanager-main-kube-prometheus-stack-alertmanager   1/1     13m
statefulset.apps/app-python                                             2/2     10m
statefulset.apps/prometheus-main-kube-prometheus-stack-prometheus       1/1     13m

NAME                                              TYPE           CLUSTER-IP       EXTERNAL-IP   PORT(S)                      AGE
service/alertmanager-operated                     ClusterIP      None             <none>        9093/TCP,9094/TCP,9094/UDP   13m
service/app-python                                LoadBalancer   10.96.151.52     <pending>     80:31026/TCP                 10m
service/kubernetes                                ClusterIP      10.96.0.1        <none>        443/TCP                      20m
service/main-grafana                              ClusterIP      10.106.195.19    <none>        80/TCP                       13m
service/main-kube-prometheus-stack-alertmanager   ClusterIP      10.109.167.202   <none>        9093/TCP                     13m
service/main-kube-prometheus-stack-operator       ClusterIP      10.101.223.83    <none>        443/TCP                      13m
service/main-kube-prometheus-stack-prometheus     ClusterIP      10.106.70.146    <none>        9090/TCP                     13m
service/main-kube-state-metrics                   ClusterIP      10.102.38.71     <none>        8080/TCP                     13m
service/main-prometheus-node-exporter             ClusterIP      10.104.232.70    <none>        9100/TCP                     13m
service/prometheus-operated                       ClusterIP      None             <none>        9090/TCP                     13m

NAME                                                                    STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
persistentvolumeclaim/app-python-volume-app-python-0                    Bound    pvc-bddf6f9a-0de0-436c-8d72-02f04247dcb6   256Mi      RWO            standard       10m
persistentvolumeclaim/app-python-volume-app-python-1                    Bound    pvc-1ef73a89-b6aa-472f-93b7-b647531358e4   256Mi      RWO            standard       10m

NAME                                                                     DATA   AGE
configmap/app-python-config                                              1      10m
configmap/kube-root-ca.crt                                               1      20m
configmap/main-grafana                                                   1      13m
configmap/main-grafana-config-dashboards                                 1      13m
configmap/main-kube-prometheus-stack-alertmanager-overview               1      13m
configmap/main-kube-prometheus-stack-apiserver                           1      13m
configmap/main-kube-prometheus-stack-cluster-total                       1      13m
configmap/main-kube-prometheus-stack-controller-manager                  1      13m
configmap/main-kube-prometheus-stack-etcd                                1      13m
configmap/main-kube-prometheus-stack-grafana-datasource                  1      13m
configmap/main-kube-prometheus-stack-grafana-overview                    1      13m
configmap/main-kube-prometheus-stack-k8s-coredns                         1      13m
configmap/main-kube-prometheus-stack-k8s-resources-cluster               1      13m
configmap/main-kube-prometheus-stack-k8s-resources-namespace             1      13m
configmap/main-kube-prometheus-stack-k8s-resources-node                  1      13m
configmap/main-kube-prometheus-stack-k8s-resources-pod                   1      13m
configmap/main-kube-prometheus-stack-k8s-resources-workload              1      13m
configmap/main-kube-prometheus-stack-k8s-resources-workloads-namespace   1      13m
configmap/main-kube-prometheus-stack-kubelet                             1      13m
configmap/main-kube-prometheus-stack-namespace-by-pod                    1      13m
configmap/main-kube-prometheus-stack-namespace-by-workload               1      13m
configmap/main-kube-prometheus-stack-node-cluster-rsrc-use               1      13m
configmap/main-kube-prometheus-stack-node-rsrc-use                       1      13m
configmap/main-kube-prometheus-stack-nodes                               1      13m
configmap/main-kube-prometheus-stack-nodes-darwin                        1      13m
configmap/main-kube-prometheus-stack-persistentvolumesusage              1      13m
configmap/main-kube-prometheus-stack-pod-total                           1      13m
configmap/main-kube-prometheus-stack-prometheus                          1      13m
configmap/main-kube-prometheus-stack-proxy                               1      13m
configmap/main-kube-prometheus-stack-scheduler                           1      13m
configmap/main-kube-prometheus-stack-workload-total                      1      13m
configmap/prometheus-main-kube-prometheus-stack-prometheus-rulefiles-0   19     13m
```

## Grafana

### i.Check how much CPU and Memory your StatefulSet is consuming

![cpu](/k8s/images/cpu.png)

![mem](/k8s/images/memory.png)

### ii.Check which Pod is using CPU more than others and which is less in the default namespace

![pods](/k8s/images/pod.png)

### iii.Check how much memory is used on your node, in % and mb

![mem](/k8s/images/memory_mb.png)

![mem2](/k8s/images/memory_pr.png)

### iv.Check how many pods and containers actually ran by the Kubelet service

![num](/k8s/images/running.png)

### v.Check which Pod is using network more than others and which is less in the default namespace

![network](/k8s/images/network.png)

### vi.Check how many alerts you have. Also you can see them in the Web UI by the minikube service monitoring-kube-prometheus-alertmanager command

![alerts](/k8s/images/alerts.png)

## Init Containers

![1](/k8s/images/init1.png)

![2](/k8s/images/init2.png)

## Bonus

![b1](/k8s/images/bonus14.png)
